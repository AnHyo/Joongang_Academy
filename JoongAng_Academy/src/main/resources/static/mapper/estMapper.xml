<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.joongAng.academy.dao.EstablishedSubjectDAO">
	<select id="estList" parameterType="HashMap" resultType="HashMap">
		SELECT CRCLM_YEAR,CRCLM_HALF, CodeFind('0018',CRCLM_HALF) AS HALF,CRCLM_CD, CodeFind('0002',CRCLM_CD) AS CRCLM_NM, SBJCT_NO, SBJCT_NM, SBJCT_EXPLN, EDU_HR, SBJCT_PLAN_YN, ROOM_NO FROM ESTBL_SBJCT
		WHERE CRCLM_CD = #{crc}
        <if test="year != ''">
			AND CRCLM_YEAR = #{year}
        </if>
        <if test="hlf != ''">
			AND CRCLM_HALF = #{hlf}
        </if>
	</select>

	<select id="estCodeList" parameterType="String" resultType="HashMap">
		SELECT * FROM CODE_INFO
		WHERE CD_CLSF = (SELECT CD FROM CODE_INFO WHERE CD_NM = #{division})
	</select>
	<select id="estYearList" parameterType="String" resultType="HashMap">
		SELECT CRCLM_YEAR FROM CRCLM_INFO
		WHERE CRCLM_CD = #{crc}
		GROUP BY CRCLM_YEAR
	</select>
	<select id="estRoomList" resultType="HashMap">
		SELECT * FROM ROOM_INFO
	</select>
	<select id="estSubjectList" parameterType="HashMap" resultType="HashMap">
		SELECT * FROM SBJCT_INFO WHERE USE_YN = 'Y'
	</select>
	
	<insert id="estSave" parameterType="HashMap">
		INSERT INTO ESTBL_SBJCT (CRCLM_YEAR,CRCLM_HALF,CRCLM_CD,SBJCT_NO,SBJCT_NM,SBJCT_EXPLN,EDU_HR,ROOM_NO)
		VALUES (#{year},#{hlf},#{crc},#{sbjcd},#{sbjnm},#{sbjxp},#{hrs},#{room})
		ON DUPLICATE KEY UPDATE
			ROOM_NO = #{room}
	</insert>
	<insert id="estPlan" parameterType="HashMap">
		INSERT IGNORE INTO SBJCT_PLAN (CRCLM_YEAR,CRCLM_HALF,CRCLM_CD,SBJCT_NO)
		VALUES (#{year},#{hlf},#{crc},#{sbjcd})
	</insert>
</mapper>